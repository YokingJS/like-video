H.264视频标准中普通I帧与IDR帧的区别

I帧与IDR（Instantaneous Decoding Refresh，瞬时解码刷新）帧为均采用帧内预测技术的视频帧，同属于I帧。
采用IDR帧编码，会导致DPB（Decoded Picture Buffer，直译为解码图像缓冲区，即指参考帧列表）完成一次清空处理，而普通I帧不会。

当前IDR帧后面的帧不会将当前IDR帧之前已经编码的帧作为参考帧；而当前普通I帧之后的帧有可能将当前I帧之前的帧作为参考帧。
播放视频的时候，可以直接从IDR帧开始播放，因为IDR帧之前的帧与当前IDR帧和之后的帧再也没有直接地关联；而普通I帧则不行。
I和IDR帧都是使用帧内预测的。IDR帧的作用是立刻刷新，从IDR帧开始，重新算一个新的序列开始编码。而I帧不具有随机访问的能力，这个功能是由IDR承担。

一．关键帧的痛点

把帧转换成图片文件连续播放，就得到了一个视频文件。不过如此的方式存储视频的话，文件势必会变得很大，而且其间有很多重复的数据。
所以需要专门的算法对视频文件进行编码。常见的就是H264。

一旦视频进行编码之后，得到的文件可以看做是连续的一组帧的集合，而这一组帧中的每一个都是有自己的类型的。帧的类型分为以下3种：
* Inter Frame（I帧）
* P-Frame（P帧）
* B-Frame（B帧）

其中只有I帧中的数据是可以自描述的，也就是说当我们获得I帧的数据之后，就可以直接解码出当前帧的图像，
对于B帧和P帧来说需要找到对应的一个或者多个参考帧才能解码出来。

因此对于非I帧来说想要进行解码就需要多个参考帧进行计算，并得出最终的结果。
由此引出了Group of Picture的概念。对于P帧和B帧来说，他们所包含的内容可以理解为针对其参考帧的一个patch，
也就是一个变化量，所以他们不用包含整个图像的信息，只要描述好与参考帧之间的变化关系即可。所以在字节大小方面，P帧和B帧要远远小于I帧的。
这也是视频压缩能节省空间的一个原因所在。

 

二．GoP性能调优分析

GoP由I帧开始，后面跟随者一组B帧和P帧，直到下一个I帧之前的帧为一个GoP。了解了GoP之后，就会发现播放器只有在拿到某个GoP中的I帧之后才能播放视频。

GoP设置比较大时：
好处：由于B帧和P帧的字节大小会比I帧小很多，所以GoP越长，所包含的B帧和P帧越多，响应的压缩比也会更高，或者说同样的码率下，视频会更清晰一些。
坏处：对于视频直播来说，播放器连接到服务器的时间是不固定的，当播放器在GoP中间连接服务器，并获取了中间的B帧和P帧，这时播放器是无法对这些帧进行解码的，
需要进行丢弃。所以会导致客户端的首屏播放时间变长（客户端需要等待一段时间才能看到图像）。

GoP设置比较小时：
好处：由于GoP设置小可以降低I帧间隔时间，对于直播来说可以实现秒开的功能。
坏处：由于GoP时间比较短，会导致I帧的比例增高，压缩比降低。同样码率情况下视频的质量会有所下降。

三．结论

对于GoP大小的取舍还是需要看具体应用场景。对延迟要求敏感的应用来说，1~2秒的GoP大小还是比较合适的，至于GoP缓存来讲，还是不用为好。
如果是对延迟要求不敏感，对首屏播放时间很敏感的应用，GoP还是1~2秒最为合适，GoP缓存应该是必备的。
对于视频加载速度是个硬指标，GoP大小适当选大一点可以降低视频文件大小，提高视频打开速度。

